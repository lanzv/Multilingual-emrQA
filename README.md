# CS-PL-SP-RM-emrQA




## Machine Translation 

### MT Model Statistics - khresmoi
The 48GB RAM node was used. Only NLLB-54B, MadLad10B and MadLad7B models are larger than the GPU free space -> load_in_4bit=True, torch_dtype=torch.float16 parameters are set while loading the model. 

We translated the english dataset into the target languages by batches of 50 sentences. That make the translation 20x faster than translating sentence by sentence.

For the evaluation, we used the ***khresmoi dataset*** (1500 medical setences translated by professionalists from the english to the cs, de, fr, hu, pl, es, sv)

The final and most accurate results are stored in the ```scripts/slurm_outputs/measure_translators.out``` file. The json output is in the file ```scripts/slurm_outputs/translator_results.json```. Rounded values are in the tables below.. 

Average table contains LINDAT averaged over only four languages (CS, DE, FR, PL) since LINDAT doesn't know SV, SE, HU. The ```scripts/slurm_outputs/translator_results.json``` file is averaged over all languages. 



|     AVERAGE          |   NLLB_600M |   NLLB_1_3B_dis |   NLLB_1_3B |   MadLad_3B |   NLLB_3_3B |   LINDAT |   MadLad_7B |   MadLad_10B |   NLLB_54B |
|:---------------------|------------:|----------------:|------------:|------------:|------------:|---------:|------------:|-------------:|-----------:|
| loading time (s)     |       6.49  |         20.02   |     20.05   |     18.04   |     40.13   |     0    |    471.67   |     601.76   |  3861.49   |
| translation time (s) |      33.6   |         54.98   |     55.81   |     98.96   |     84.64   |   838.62 |    302.84   |     326.79   |   956.99   |
| bleu                 |      31.66  |         34.19   |     33.9    |     37.68   |     35.14   |    33.74 |     37.65   |    **37.77** |    36.2    |
| meteor               |       0.567 |          0.5911 |      0.5895 |      0.6258 |      0.6022 |     0.59 |      0.6264 |    **0.6267**|     0.6102 |
| wer                  |      52.9   |         50.63   |     50.76   |     47.15   |     49.82   |    50.75 |     47.44   |    **46.98** |    48.75   |
| cer                  |      39.31  |         37.68   |     37.94   |     35.15   |     36.93   |    37.73 |     35.27   |    **34.94** |    36.14   |

|  EN -> CS (1500 sens)|   NLLB_600M |   NLLB_1_3B_dis |   NLLB_1_3B |   MadLad_3B |   NLLB_3_3B |   LINDAT |   MadLad_7B |   MadLad_10B |   NLLB_54B |
|:---------------------|------------:|----------------:|------------:|------------:|------------:|---------:|------------:|-------------:|-----------:|
| translation time (s) |      33.31  |         51.62   |     51.31   |     95.37   |     81.49   | 798.94   |    295.92   |     323.23   |    922.34  |
| bleu                 |      28.87  |         34.65   |     33.02   |     38.85   |     35.04   |  39.04   |     38.77   |    **39.28** |     38.23  |
| meteor               |       0.544 |          0.5911 |      0.5837 |      0.6367 |      0.6018 |   0.6337 |      0.6341 |    **0.6394**|      0.623 |
| wer                  |      55.41  |         50.35   |     51.62   |     45.91   |     49.97   |**45.56** |     46.15   |      45.61   |     47.28  |
| cer                  |      41.1   |         37.7    |     38.81   |     34.71   |     37.32   |  34.55   |     35.01   |    **34.38** |     35.36  |

|  EN -> DE (1500 sens)|   NLLB_600M |   NLLB_1_3B_dis |   NLLB_1_3B |   MadLad_3B |   NLLB_3_3B |   LINDAT |   MadLad_7B |   MadLad_10B |   NLLB_54B |
|:---------------------|------------:|----------------:|------------:|------------:|------------:|---------:|------------:|-------------:|-----------:|
| translation time (s) |     29.21   |          49.26  |     49.54   |      96.25  |     86.63   | 840.16   |     299.54  |     326.04   |  1024.32   |
| bleu                 |     30.08   |          31.3   |     31.4    |      34.43  |     32.59   |  30.77   |      34.47  |    **34.7**  |    33.46   |
| meteor               |      0.5732 |           0.585 |      0.5839 |       0.611 |      0.5949 |   0.5785 |    **0.613** |       0.6101 |     0.5992 |
| wer                  |     52.18   |          51.14  |     51.33   |  **49.03**  |     50.95   |  52.69   |      49.16  |    **49.03** |    50.36   |
| cer                  |     38.48   |          37.6   |     37.88   |    35.94    |     37.44   |  38.24   |      36.07  |    **35.78** |    37.19   |

|  EN -> FR (1500 sens)|   NLLB_600M |   NLLB_1_3B_dis |   NLLB_1_3B |   MadLad_3B |   NLLB_3_3B |   LINDAT |   MadLad_7B |   MadLad_10B |   NLLB_54B |
|:---------------------|------------:|----------------:|------------:|------------:|------------:|---------:|------------:|-------------:|-----------:|
| translation time (s) |      33.62  |         51.32   |     51.68   |     99.54   |     89.56   | 937.41   |    310.4    |     339.98   |   1039.16  |
| bleu                 |      46.67  |         47.65   |     48.17   |     49.21   |     47.99   |  47.28   |     48.93   |   **49.88**   |     48.3   |
| meteor               |       0.713 |          0.7188 |      0.7224 |      0.7307 |      0.7218 |   0.7144 |      0.7305 |   **0.7364** |      0.723 |
| wer                  |      41.43  |         40.67   |     39.93   |     40.33   |     40.68   |  39.65   |     41.03   |    **39.46** |     40.65  |
| cer                  |      27.82  |         27.01   |     26.94   |     26.72   |     27.17   |  27.9    |     26.87   |    **26.4**  |     26.84  |

|  EN -> HU (1500 sens)|   NLLB_600M |   NLLB_1_3B_dis |   NLLB_1_3B |   MadLad_3B |   NLLB_3_3B |   LINDAT |   MadLad_7B |   MadLad_10B |   NLLB_54B |
|:---------------------|------------:|----------------:|------------:|------------:|------------:|---------:|------------:|-------------:|-----------:|
| translation time (s) |     35.9    |         68.16   |     55.54   |    127.29   |     89.52   |        - |    313.19   |      351.09  |   949.36   |
| bleu                 |     13.04   |         15.8    |     15.29   |     19.41   |     16.96   |        - |   **20.48** |       19.94  |    18.91   |
| meteor               |      0.3577 |          0.3948 |      0.3899 |      0.4403 |      0.4114 |        - |   **0.4517**|        0.448 |     0.4317 |
| wer                  |     72.66   |         69.78   |     69.62   |     65.37   |     68.37   |        - |     64.89   |     **64.43**|    65.93   |
| cer                  |     56.87   |         55.27   |     54.9    |     52.33   |     53.62   |        - |     51.33   |     **51.29**|    51.73   |

|  EN -> PL (1500 sens)|   NLLB_600M |   NLLB_1_3B_dis |   NLLB_1_3B |   MadLad_3B |   NLLB_3_3B |   LINDAT |   MadLad_7B |   MadLad_10B |   NLLB_54B |
|:---------------------|------------:|----------------:|------------:|------------:|------------:|---------:|------------:|-------------:|-----------:|
| translation time (s) |     45.09   |           69.6  |      93.33  |    102.33   |     90.5    | 777.98   |    320.2    |     350.61   |  1016.16   |
| bleu                 |     14.97   |           17.37 |      16.94  |     20.46   |     18.41   |  17.87   |   **20.95** |      20.5    |    19.24   |
| meteor               |      0.3786 |            0.41 |       0.407 |      0.4545 |      0.4264 |   0.4163 |  **0.4598** |       0.4546 |     0.4368 |
| wer                  |     70.64   |           66.7  |      68.07  |     62.33   |     65.36   |  65.1    |   **61.8**  |      62.1    |    63.98   |
| cer                  |     55.53   |           52.33 |      53.83  |     48.11   |     50.73   |  50.24   |   **47.67** |      47.9    |    49.55   |

|  EN -> ES (1500 sens)|   NLLB_600M |   NLLB_1_3B_dis |   NLLB_1_3B |   MadLad_3B |   NLLB_3_3B |   LINDAT |   MadLad_7B |   MadLad_10B |   NLLB_54B |
|:---------------------|------------:|----------------:|------------:|------------:|------------:|---------:|------------:|-------------:|-----------:|
| translation time (s) |     27.08   |         45.81   |     45.87   |     87.71   |     80.15   |        - |    278.2    |     305.52   |   921.33   |
| bleu                 |     46.09   |         47.62   |     47.19   |   **49.05** |     48.05   |        - |     48.55   |      48.27   |    47.98   |
| meteor               |      0.7364 |          0.7462 |      0.7476 |  **0.7596** |      0.7534 |        - |      0.7555 |       0.7545 |     0.7505 |
| wer                  |     37.85   |         37.12   |     37.44   |   **35.7**  |     36.84   |        - |     36.27   |      36.48   |    36.7    |
| cer                  |     26.41   |         26.3    |     26.47   |  **25.19**  |     26.05   |        - |     25.72   |      25.69   |    26.12   |

|  EN -> SV (1500 sens)|   NLLB_600M |   NLLB_1_3B_dis |   NLLB_1_3B |   MadLad_3B |   NLLB_3_3B |   LINDAT |   MadLad_7B |   MadLad_10B |   NLLB_54B |
|:---------------------|------------:|----------------:|------------:|------------:|------------:|---------:|------------:|-------------:|-----------:|
| translation time (s) |     31      |          49.1   |      43.37  |     84.19   |     74.63   |        - |    302.41   |     291.06   |   826.25   |
| bleu                 |     41.93   |          44.95  |      45.31  |    **52.34**|     46.97   |        - |     51.42   |      51.82   |    47.26   |
| meteor               |      0.6658 |           0.692 |       0.692 |    **0.748**|      0.7059 |        - |      0.7402 |       0.7437 |     0.7071 |
| wer                  |     40.1    |          38.63  |      37.32  |    **31.4** |     36.55   |        - |     32.76   |      31.78   |    36.34   |
| cer                  |     28.93   |          27.54  |      26.77  |    **23.07**|     26.17   |        - |     24.21   |      23.14   |    26.2    |



## Evidence Alignment

### Medication

#### Awesome Alignment

|                 | BG       | CS       | EL       | ES       | PL       | RO       |
|-----------------|----------|----------|----------|----------|----------|----------|
| f1              | 88.52    | 92.51    | 69.50    | 95.97    | 90.31    | 93.32    |
| em              | 59.03    | 66.24    | 25.54    | 73.17    | 59.26    | 67.82    |
| exact submatch  | 88.07    | 88.13    | 79.88    | 92.89    | 86.76    | 92.05    |
| f1 span         | 88.14    | 92.31    | 68.84    | 95.77    | 90.04    | 92.95    |
| precision span  | 85.10    | 90.43    | 63.03    | 94.37    | 87.49    | 90.70    |
| recall span     | 97.74    | 97.90    | 93.75    | 97.87    | 97.77    | 98.55    |
| start distance  | -10.74   | -4.72    | -29.94   | -2.22    | -8.98    | -5.21    |
| middle distance | 0.60     | 1.31     | 5.62     | 0.70     | 0.08     | 0.68     |
| end distance    | 11.94    | 7.34     | 41.17    | 3.62     | 9.15     | 6.58     |
| abs(start dst)  | 13.14    | 7.90     | 43.84    | 3.83     | 10.53    | 6.89     |
| abs(mid dst)    | 9.80     | 6.76     | 30.90    | 3.49     | 8.01     | 5.71     |
| abs(end dst)    | 13.20    | 8.50     | 43.91    | 4.29     | 10.44    | 7.37     |
| overall time    | 25308.67 | 23883.82 | 42715.21 | 22538.61 | 25391.91 | 25186.79 |

#### CS

|                          | Levenshtein | FastAlign | Awesome     |
|--------------------------|-------------|-----------|-------------|
| f1 (%)                   | 81.5242     | 90.2794   | **92.5061** |
| exact match (%)          | 26.4555     | 52.8824   | **66.2100** |
| exact submatch (%)       | 74.0868     | 76.7266   | **88.0993** |
| f1 span (%)              | 78.6911     | 89.7825   | **92.3010** |
| precision span (%)       | 72.5578     | 89.0736   | **90.4308** |
| recall span (%)          | 90.5884     | 95.1786   | **97.8830** |
| start dist (chars)       | -15.2925    | -5.5183   | **-4.7103** |
| middle dist (chars)      | -4.1770     | 1.4585    | **1.3075**  |
| end dist (chars)         | **6.9385**  | 8.4354    | 7.3253      |
| abs(start dist) (chars)  | 36.5947     | 10.8154   | **7.9055**  |
| abs(middle dist) (chars) | 30.7720     | 9.1500    | **6.7628**  |
| abs(end dist) (chars)    | 32.1797     | 10.4930   | **8.5043**  |
| time (s)                 | 12835       | 2952      | 23221       |

### Relations

#### Awesome 

|                 | BG       | CS       | EL       | ES       | PL       | RO       |
|-----------------|----------|----------|----------|----------|----------|----------|
| f1              | 89.20    | 93.02    | 76.85    | 96.80    | 89.81    | 94.22    |
| em              | 67.68    | 71.22    | 41.74    | 79.94    | 63.45    | 76.84    |
| exact submatch  | 88.12    | 83.22    | 82.48    | 84.96    | 82.17    | 88.81    |
| f1 span         | 88.77    | 92.83    | 76.47    | 96.96    | 89.39    | 93.93    |
| precision span  | 86.94    | 92.46    | 71.97    | 97.21    | 88.23    | 93.30    |
| recall span     | 97.07    | 96.92    | 95.16    | 97.96    | 96.37    | 97.55    |
| start distance  | -11.29   | -4.34    | -22.74   | 1.76     | -7.97    | -2.27    |
| middle distance | 1.00     | 1.88     | 5.51     | 3.08     | 1.61     | 2.63     |
| end distance    | 13.28    | 8.10     | 33.77    | 4.39     | 11.20    | 7.54     |
| abs(start dst)  | 15.63    | 9.94     | 35.46    | 5.52     | 12.92    | 9.46     |
| abs(mid dst)    | 11.20    | 7.85     | 25.89    | 4.84     | 9.75     | 7.69     |
| abs(end dst)    | 13.96    | 8.69     | 35.52    | 4.73     | 12.01    | 8.04     |
| overall time    | 39761.12 | 37191.16 | 41449.54 | 35514.34 | 39882.23 | 38751.78 |

#### CS

|                          | Levenshtein | FastAlign   | Awesome     |
|--------------------------|-------------|-------------|-------------|
| f1 (%)                   | 85.7290     | **93.2484** | 93.0164     |
| exact match (%)          | 35.5312     | 68.1078     | **71.1927** |
| exact submatch (%)       | 84.2168     | 81.8705     | **83.2066** |
| f1 span (%)              | 82.9966     | 92.5678     | **92.8223** |
| precision span (%)       | 76.6173     | **92.9844** | 92.4547     |
| recall span (%)          | 93.7152     | 95.6225     | **96.9220** |
| start dist (chars)       | -13.7699    | **-2.8955** | -4.3442     |
| middle dist (chars)      | -3.4131     | 2.0120      | **1.8843**  |
| end dist (chars)         | 6.9437      | **6.9174**  | 8.1128      |
| abs(start dist) (chars)  | 28.6880     | 10.1010     | **9.9595**  |
| abs(middle dist) (chars) | 22.4206     | 8.8024      | **7.8590**  |
| abs(end dist) (chars)    | 21.9411     | 9.1916      | **8.7056**  |
| time (s)                 | 26079       | 23344       | 37179       |




## PRQA
### Medication

|              | BG med | CS med | EL med | EN med | ES med | PL med | RO med |
|--------------|--------|--------|--------|--------|--------|--------|--------|
| kept (%)     | 79.1   | 87.2   | 46.7   | 100.0  | 94.6   | 83.5   | 88.7   |
| PR (P@1)     | 78.64  | 81.83  | 66.88  | 86.39  | 82.58  | 80.82  | 82.58  |
| PR (P@2)     | 92.69  | 95.03  | 83.47  | 97.42  | 95.61  | 94.64  | 95.38  |
| PR (P@3)     | 96.47  | 98.14  | 90.16  | 99.20  | 98.10  | 98.01  | 98.30  |
| Oracle-QA F1 | 67.50  | 70.02  | 58.17  | 73.26  | 70.52  | 69.12  | 70.91  |
| Oracle-QA EM | 21.99  | 24.00  | 17.11  | 28.83  | 25.62  | 24.52  | 25.54  |
| PR-QA F1     | 58.74  | 62.33  | 46.75  | 68.19  | 63.66  | 61.10  | 63.87  |
| PR-QA EM     | 19.39  | 21.91  | 15.02  | 27.42  | 23.40  | 22.20  | 23.45  |


### Relations

|              | BG rel | CS rel | EL rel | EN rel | ES rel | PL rel | RO rel |
|--------------|--------|--------|--------|--------|--------|--------|--------|
| kept (%)     | 79.3   | 87.9   | 57.3   | 100.0  | 95.8   | 81.2   | 89.2   |
| PR (P@1)     | 85.83  | 8838   | 79.91  | 96.41  | 89.72  | 84.84  | 88.85  |
| PR (P@2)     | 94.67  | 9599   | 90.22  | 99.60  | 96.70  | 94.03  | 96.09  |
| PR (P@3)     | 96.99  | 9777   | 93.72  | 99.92  | 98.08  | 96.29  | 97.75  |
| Oracle-QA F1 | 89.40  | 91.36  | 84.19  | 91.41  | 92.14  | 88.82  | 91.48  |
| Oracle-QA EM | 73.28  | 75.01  | 57.12  | 97.09  | 76.23  | 71.05  | 76.05  |
| PR-QA F1     | 81.42  | 84.05  | 73.41  | 94.82  | 86.60  | 80.24  | 84.73  |
| PR-QA EM     | 65.91  | 68.77  | 49.28  | 88.69  | 71.14  | 63.90  | 70.04  |